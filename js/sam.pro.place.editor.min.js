var sam=sam||{};(function(n){var i,e=options.media,r=parseInt(options.item,10),f=options.locale.changeLocale?options.locale.locale:"en-US",t=options.strings,u=options.wap;sam.media=i={};sam.media=i={buttonId:"#banner-media",adUrl:"#img",adImgId:"#img_id",adName:"#title",adDesc:"#description",adAlt:"#alt",init:function(){n(this.buttonId).on("click",this.openMediaDialog)},openMediaDialog:function(n){if(n.preventDefault(),this._frame){this._frame.open();return}this._frame=i.frame=wp.media({title:e.title,button:{text:e.button},multiple:!1,library:{type:"image"}});this._frame.state("library").on("select",function(){var n=this.get("selection").single();i.handleMediaAttachment(n)});this._frame.open()},handleMediaAttachment:function(t){var i=t.toJSON();n(this.adUrl).val(i.url);n(this.adImgId).val(i.id);""==n(this.adName).val()&&""!=i.title&&n(this.adName).val(i.title);""==n(this.adDesc).val()&&""!=i.caption&&n(this.adDesc).val(i.caption);""==n(this.adAlt).val()&&""!=i.alt&&n(this.adAlt).val(i.alt)}};n(document).ready(function(){n("#tabs").ejTab({enablePersistence:!0});i.init();var o=n("#rc-ami"),s=n("#rc-amc"),h=n("#rc-amd");n("input:radio[name=amode]").on("click",function(){var t=n("input:radio[name=amode]:checked").val();t==0?(o.is(":hidden")&&o.show("blind",{direction:"vertical"},500),s.is(":visible")&&s.hide("blind",{direction:"vertical"},500),h.is(":visible")&&h.hide("blind",{direction:"vertical"},500)):t==1?(s.is(":hidden")&&s.show("blind",{direction:"vertical"},500),o.is(":visible")&&o.hide("blind",{direction:"vertical"},500),h.is(":visible")&&h.hide("blind",{direction:"vertical"},500)):t==2&&(h.is(":hidden")&&h.show("blind",{direction:"vertical"},500),s.is(":visible")&&s.hide("blind",{direction:"vertical"},500),o.is(":visible")&&o.hide("blind",{direction:"vertical"},500))});var p=n("#rc-sale"),w=n("#sale"),c=n("#rc-sale-mode");w.on("click",function(){w.is(":checked")?p.show("blind",{direction:"vertical"},500):p.hide("blind",{direction:"vertical"},500)});n("input:radio[name=sale_mode]").on("click",function(){var t=n("input:radio[name=sale_mode]:checked").val();t==0?c.is(":hidden")&&c.show("blind",{direction:"vertical"},500):c.is(":visible")&&c.hide("blind",{direction:"vertical"},500)});var l=n("#code_before"),a=n("#code_after"),b=n("#width").val()+"px";n("#sam-pro-center").on("click",function(n){n.preventDefault();l.val("<div style='text-align:center'>");a.val("<\/div>")});n("#sam-pro-left").on("click",function(n){n.preventDefault();l.val("<div style='float: left; width: "+b+";'>");a.val("<\/div>")});n("#sam-pro-right").on("click",function(n){n.preventDefault();l.val("<div style='float: right; width: "+b+";'>");a.val("<\/div>")});var k=n("#sdate"),d=n("#fdate"),rt=n("#startDate").ejDateTimePicker({width:250,locale:f,buttonText:options.buttonText,dateTimeFormat:"yyyy-MM-dd HH:mm:ss",timeDisplayFormat:"HH:mm:ss",value:k.val(),change:function(n){k.val(n.value)}}).data("ejDateTimePicker"),ut=n("#finishDate").ejDateTimePicker({width:250,locale:f,buttonText:options.buttonText,dateTimeFormat:"yyyy-MM-dd HH:mm:ss",timeDisplayFormat:"HH:mm:ss",value:d.val(),change:function(n){d.val(n.value)}}).data("ejDateTimePicker");if(r>0){var g,v,y=n("#adsDialog").ejDialog({width:830,allowDraggable:!0,enableModal:!0,showOnInit:!1}).data("ejDialog"),e=new Selectors,nt=ej.DataManager({url:options.samProAjax+"sam-pro-ajax-admin.php?action=load_places_ads_item&pid="+r+"&wap="+u,removeUrl:options.samProAjax+"sam-pro-ajax-admin.php?action=unlink_ad_item&pid="+r+"&wap="+u,updateUrl:options.samProAjax+"sam-pro-ajax-admin.php?action=update_place_ad&wap="+u,requestType:"json",adaptor:new ej.UrlAdaptor}),tt=n("#grid").ejGrid({dataSource:nt,locale:f,allowSorting:!0,allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},allowSelection:!0,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},editSettings:{allowEditing:!0,allowDeleting:!0,showDeleteConfirmDialog:!0},toolbarSettings:{showToolbar:!0,toolbarItems:["edit",ej.Grid.ToolBarItems.Update,ej.Grid.ToolBarItems.Cancel,ej.Grid.ToolBarItems.Delete],customToolbarItems:["Link","Edit_Ad","Refresh"]},columns:[{field:"pid",headerText:"Place ID",visible:!1},{field:"aid",headerText:t.adId,isPrimaryKey:!0,allowEditing:!1,textAlign:ej.TextAlign.Right,width:90},{field:"title",headerText:t.name,allowEditing:!1,width:180},{field:"description",headerText:t.desc,allowEditing:!1},{field:"weight",headerText:t.weight,textAlign:ej.TextAlign.Right,allowEditing:!0,editType:ej.Grid.EditingType.Numeric,defaultValue:10,validationRules:{range:[0,10]},width:100},{field:"trash",headerText:t.status,allowEditing:!1,textAlign:ej.TextAlign.Center,width:100}],create:function(){n(".Link").parent("li").attr("title",t.linkAds);n("#grid_delete").attr("title",t.unlinkAd);n(".Refresh").parent("li").attr("title",t.refresh);n(".Edit_Ad").parent("li").attr("title",t.editAd)},toolbarClick:function(t){var i=n(t.target),r=this.getSelectedRecords(),u;i.hasClass("Refresh")?this.refreshContent():i.hasClass("Link")?it():i.hasClass("Edit_Ad")&&r.length>0&&(u=r[0].aid,document.location=options.adEditorUrl+u)},actionComplete:function(){var i=n("#grid_toolbarItems"),t;t=n("#grid_delete");i.ejToolbar("disableItem",t);t=n("#grid_Edit_Ad");i.ejToolbar("disableItem",t)},recordClick:function(){var i=n("#grid_toolbarItems"),t;t=n("#grid_delete");i.ejToolbar("disableItem",t);t=n("#grid_Edit_Ad");i.ejToolbar("disableItem",t)},rowSelected:function(){var i=n("#grid_toolbarItems"),t,r=this.getSelectedRecords();r.length>0&&(t=n("#grid_delete"),i.ejToolbar("enableItem",t),t=n("#grid_Edit_Ad"),i.ejToolbar("enableItem",t))}}).data("ejGrid");function it(){g=ej.DataManager({url:options.samProAjax+"sam-pro-ajax-admin.php?action=list_ads&pid="+r+"&wap="+u,requestType:"json",adaptor:new ej.UrlAdaptor});v=n("#adsGrid").ejGrid({dataSource:g,locale:f,allowTextWrap:!0,allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},columns:[{field:"aid",headerText:t.adId,isPrimaryKey:!0,textAlign:ej.TextAlign.Right,width:120},{field:"title",headerText:t.name,width:280},{field:"description",headerText:t.desc,width:400}],rowSelected:function(n){if(!e.service){e.page=n.model.pageSettings.currentPage;var t=e.pids[e.page].slice(0),i=t.indexOf(n.data.aid);i>-1?e.removePid(n.data.aid):e.pids=n.data.aid}},actionComplete:function(n){var t,i,r=e.ids.slice(0);if(e.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].aid&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(e.page=n.currentPage,e.pids=this.model.currentViewData[t].aid):n.requestType=="refresh"&&(e.page=1,e.pids=this.model.currentViewData[t].aid));e.service=!1}}).data("ejGrid");e.sid="";y.open()}n("#cancel-ads").on("click",function(){y.close();v.destroy()});n("#select-ads").on("click",function(){var t=e.sid;t!=""&&n.post(options.samProAjax+"sam-pro-ajax-admin.php?action=link_ads",{pid:r,sid:t,wap:u}).done(function(){tt.refreshContent()});y.close();v.destroy()})}})})(jQuery)
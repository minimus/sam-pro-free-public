(function(n){var f=options.locale.changeLocale?options.locale.locale:"en-US",t=options.strings,u=options.wap,i=options.periods[options.period].start,r=options.periods[options.period].end,e=options.period<20?"days":"months",o=options.period<20?f=="ru-RU"?"d MMM":"MMM dd":"MMM, yyyy",s=options.view=="all"?"":options.owner==="all"?t.advertisers:t.advertiser+": "+options.owner,h=options.samProAjax+(options.view=="sold"?"sam-pro-ajax-admin.php?action=load_chart_data":"sam-pro-ajax-admin.php?action=load_chart_data_all")+"&wap="+u,c=options.samProAjax+(options.view=="sold"?"sam-pro-ajax-admin.php?action=load_grid_data":"sam-pro-ajax-admin.php?action=load_grid_data_all")+"&wap="+u,l=options.samProAjax+(options.view=="sold"?"sam-pro-ajax-admin.php?action=load_grid_child_data&start="+i+"&end="+r+"&owner="+options.owner+"&period="+options.period:"sam-pro-ajax-admin.php?action=load_grid_child_data_all&start="+i+"&end="+r+"&owner="+options.owner+"&period="+options.period)+"&wap="+u,a=options.samProAjax+(options.view=="sold"?"sam-pro-ajax-admin.php?action=load_pie_data":"sam-pro-ajax-admin.php?action=load_pie_data_all")+"&wap="+u,v=options.samProAjax+(options.view=="sold"?"sam-pro-ajax-admin.php?action=load_pie_data_2":"sam-pro-ajax-admin.php?action=load_pie_data_2_all")+"&wap="+u;n(document).ready(function(){function b(s,h){var a=options.samProAjax+"sam-pro-ajax-admin.php?action=load_ad_chart_data&wap="+u,c=ej.DataManager({url:a,requestType:"json",adaptor:new ej.UrlAdaptor}),l=(new ej.Query).addParams("aid",s).addParams("pid",h).addParams("start",i).addParams("end",r).addParams("period",options.period);return n("#ad-chart").ejChart({locale:f,enableCanvasRendering:!0,canResize:!0,theme:ej.datavisualization.Chart.Theme.FlatLight,title:{text:options.periods[options.period].title,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold"}},primaryXAxis:{valueType:"datetime",intervalType:e,labelFormat:o},series:[{name:t.impressions,type:"column",dataSource:c,xName:"mdate",yName:"hits",query:l,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#FF7777",verticalTextAlignment:"top",offset:20,shape:"rectangle",font:{color:"white"}}}},{name:t.clicks,type:"column",dataSource:c,xName:"mdate",yName:"clicks",query:l,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#ffd45a",verticalTextAlignment:"top",offset:20,shape:"rectangle",font:{color:"white"}}}}]}).data("ejChart")}var y=n("#chart-dialog").ejDialog({width:950,allowDraggable:!0,enableModal:!0,showOnInit:!1}).data("ejDialog");n("#close-chart").on("click",function(n){n.preventDefault();y.close()});var p=ej.DataManager({url:h,requestType:"json",adaptor:new ej.UrlAdaptor}),w=(new ej.Query).addParams("item",options.item).addParams("start",i).addParams("end",r).addParams("owner",options.owner).addParams("period",options.period),ft=n("#chart").ejChart({locale:f,enableCanvasRendering:!0,canResize:!0,theme:ej.datavisualization.Chart.Theme.FlatLight,title:{text:options.periods[options.period].title,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold"},subTitle:{text:s,font:{size:"14px",fontFamily:'"Open Sans",sans-serif',fontWeight:"bold"}}},primaryXAxis:{valueType:"datetime",intervalType:e,labelFormat:o},series:[{name:t.impressions,type:"column",dataSource:p,xName:"mdate",yName:"hits",query:w,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#FF7777",verticalTextAlignment:"top",offset:20,shape:"rectangle",font:{color:"white"}}}},{name:t.clicks,type:"column",dataSource:p,xName:"mdate",yName:"clicks",query:w,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#ffd45a",verticalTextAlignment:"top",offset:20,shape:"rectangle",font:{color:"white"}}}}]}),k=ej.DataManager({url:c,requestType:"json",adaptor:new ej.UrlAdaptor}),d=ej.DataManager({url:l,requestType:"json",adaptor:new ej.UrlAdaptor}),g=options.view=="sold"?[{field:"pid",headerText:t.adId,isPrimaryKey:!0,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80},{field:"income",headerText:t.income,textAlign:ej.TextAlign.Right,width:100},{field:"cpm",headerText:"CPM",textAlign:ej.TextAlign.Right,width:100},{field:"cpc",headerText:"CPC",textAlign:ej.TextAlign.Right,width:100},{field:"ctr",headerText:"CTR",textAlign:ej.TextAlign.Right,width:100}]:[{field:"pid",headerText:t.adId,isPrimaryKey:!0,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80},{field:"sold",headerText:t.status,textAlign:ej.TextAlign.Center,width:100}],nt=options.view=="sold"?[{field:"pid",headerText:"Place ID",isPrimaryKey:!0,visible:!1},{field:"aid",headerText:t.adId,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80},{field:"income",headerText:t.income,textAlign:ej.TextAlign.Right,width:100},{field:"cpm",headerText:"CPM",textAlign:ej.TextAlign.Right,width:100},{field:"cpc",headerText:"CPC",textAlign:ej.TextAlign.Right,width:100},{field:"ctr",headerText:"CTR",textAlign:ej.TextAlign.Right,width:100}]:[{field:"pid",headerText:"Place ID",isPrimaryKey:!0,visible:!1},{field:"aid",headerText:t.adId,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80}],et=n("#grid").ejGrid({dataSource:k,query:(new ej.Query).addParams("item",options.item).addParams("start",i).addParams("end",r).addParams("owner",options.owner).addParams("period",options.period),locale:f,allowTextWrap:!0,allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},allowSelection:!0,selectionType:ej.Grid.SelectionType.Single,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},columns:g,childGrid:{dataSource:d,queryString:"pid",locale:f,allowTextWrap:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Single,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},toolbarSettings:{showToolbar:!0,customToolbarItems:["Ad_Chart"]},columns:nt,actionComplete:function(t){if(t.requestType=="refresh"){var i=n("#"+this._id+"_toolbarItems"),r=n("#"+this._id+"_Ad_Chart");i.ejToolbar("disableItem",r)}},toolbarClick:function(t){var u=n(t.target),i=this.getSelectedRecords(),f=i[0].pid,e=i[0].aid,r;u.hasClass("Ad_Chart")&&(r=b(e,f),y.open(),r.redraw())},recordClick:function(){var t=n("#"+this._id+"_toolbarItems"),i=n("#"+this._id+"_Ad_Chart"),r=this.getSelectedRecords(),u=r.length==0?"disableItem":"enableItem";t.ejToolbar(u,i)},create:function(){n(".Ad_Chart").parent("li").attr("title",t.statistics)}}}).data("ejGrid"),tt=ej.DataManager({url:a,requestType:"json",adaptor:new ej.UrlAdaptor}),it=ej.DataManager({url:v,requestType:"json",adaptor:new ej.UrlAdaptor}),rt=(new ej.Query).addParams("item",options.item).addParams("start",i).addParams("end",r).addParams("owner",options.owner).addParams("period",options.period),ut=(new ej.Query).addParams("item",options.item).addParams("start",i).addParams("end",r).addParams("owner",options.owner).addParams("period",options.period),ot=n("#pieChartHits").ejChart({title:{text:t.impressions,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold",size:"20px"}},series:[{dataSource:tt,query:rt,xName:"title",yName:"hits",type:"doughnut",tooltip:{format:"#point.x# : #point.y#",visible:!0},labelPosition:"outside",doughnutCoefficient:.4,marker:{dataLabel:{visible:!0,connectorLine:{height:20},font:{size:"13px"}}}}],legend:{visible:!0}}),st=n("#pieChartClicks").ejChart({title:{text:t.clicks,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold",size:"20px"}},series:[{dataSource:it,query:ut,tooltip:{format:"#point.x# : #point.y#",visible:!0},xName:"title",yName:"clicks",type:"doughnut",marker:{dataLabel:{visible:!0,connectorLine:{height:20},font:{size:"13px"}}},labelPosition:"outside"}],legend:{visible:!0}})})})(jQuery)